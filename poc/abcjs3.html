<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>SATB Beispiel abcjs</title>
<script src="https://cdn.jsdelivr.net/npm/abcjs/dist/abcjs-basic-min.js"></script>
</head>
<body>

<div id="abc_dr-output">
</div>
<button class='play1'>Play</button>
<button class='stop1'>Stop</button>

<div id="abd_toene-output"></div>
<button class='play2'>Play</button>
<button class='stop2'>Stop</button>

<div id="abd_dr_toene-output"></div>
<button class='play3'>Play</button>
<button class='stop3'>Stop</button>

<script>
const abcNotationDrei = `
T: SATB Beispiel Dreiklang
M: D
L: 1/4
K: D
V: 1 
[D2F2A2] z | DFAFD |
V: 2 clef=bass
z2z | zzzzz |
`;


const dreiKlangVisualObj = window.ABCJS.renderAbc("abc_dr-output", abcNotationDrei, {
  //tablature: [{instrument: 'violin'}]
})[0];

const abcNotationToene = `
T: SATB Beispiel Dreiklang + Töne
M: D
L: 1/4
K: D
V: 1 
[D2F2A2] z |  FD zz |
V: 2 clef=bass
z2z | zz A,D, |
`;


const toeneVisualObj = window.ABCJS.renderAbc("abd_toene-output", abcNotationToene, {
  //tablature: [{instrument: 'violin'}]
})[0];


const abcNotationDreiToene = `
T: SATB Beispiel Dreiklang + Töne
M: D
L: 1/4
K: D
V: 1 
[D2F2A2] z | DFAFD z | FD zz |
V: 2 clef=bass
z2z | zzzzzz | zz A,D, |
`;


const dreiKlangToeneVisualObj = window.ABCJS.renderAbc("abd_dr_toene-output", abcNotationDreiToene, {
  //tablature: [{instrument: 'violin'}]
})[0];


document.querySelector("button.play1").addEventListener("click", onClickPlay1);
document.querySelector("button.stop1").addEventListener("click", onClickStop);
document.querySelector("button.play2").addEventListener("click", onClickPlay2);
document.querySelector("button.stop2").addEventListener("click", onClickStop);
document.querySelector("button.play3").addEventListener("click", onClickPlay3);
document.querySelector("button.stop3").addEventListener("click", onClickStop);

const midiBuffer = new ABCJS.synth.CreateSynth();
const audioContext = new AudioContext();

function onClickPlay1() {
  audioContext.resume().then(onAudioContextResumedDrei);
}
function onClickPlay2() {
  audioContext.resume().then(onAudioContextResumedToene);
}
function onClickPlay3() {
  audioContext.resume().then(onAudioContextResumedDreiToene);
}
function onClickStop() {
	midiBuffer.stop();
}
const reset = debounce(() => {
	onClickStop();
  onClickPlay();
});

function onAudioContextResumedDrei()
{
	onAudioContextResumed(dreiKlangVisualObj);
}

function onAudioContextResumedToene()
{
	onAudioContextResumed(toeneVisualObj);
}

function onAudioContextResumedDreiToene()
{
	onAudioContextResumed(dreiKlangToeneVisualObj);
}

function onAudioContextResumed(visualObj) {
  // preloads and caches all notes needed. may be significant network traffic
  return midiBuffer.init({
    visualObj: visualObj,
    audioContext: audioContext,
    <!-- millisecondsPerMeasure: bpmToMs(speedSlider.value) -->
  })
  .then(() => midiBuffer.prime()) // actually builds the output buffer.
	.then(() => {
    midiBuffer.start(); // At this point, everything slow has happened.
    return Promise.resolve();
  })
  .catch(console.warn.bind(console));
}

function debounce(func, timeout = 400) {
  let timer;
  return (...args) => {
    clearTimeout(timer);
    timer = setTimeout(() => { func.apply(this, args); }, timeout);
  };
}
</script>
<!-- F-Dur / f' d' f g 
D-Dur / fis' d' a d
-->

</body>
</html>